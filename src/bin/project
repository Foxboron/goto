#!/bin/bash

STATEDIR=${HOME}/.goto

_usage() {
    echo "Usage: project [add <projectname>] | [list]"
    echo "   other commands:"
    echo "     add <projectname> - adds a new project and makes it the active project."
    echo "     rm  <projectname> - removes the project"
    echo "     list              - lists all projects"
    echo "     help              - if you want to read this one more time."
}

_addproject() {
    touch "$STATEDIR/projects/$1"
}

_rmproject() {
    rm "$STATEDIR/projects/$1"
}

_listprojects() {
    ls "$STATEDIR/projects" | grep -v .json
}

_changeproject() {
    echo "$1" > "$STATEDIR/active-project"
    echo "active project is now: $1"
}

_showactiveproject() {
    cat "$STATEDIR/active-project" 
}

# ---------------------------
#  args parsing below
# ---------------------------
if [ $# -eq 0 ]
	then _showactiveproject && exit
fi


if [ "$1" = "list" ] 
    then _listprojects && exit 
fi


if [ "$1" = "help" ] 
    then _usage 
fi


if [ "$1" = "add" ] 
    then 
    if [ "$2" = "" ] ; then
        _usage
    else
	   _addproject "$2"
       _changeproject "$2"
        exit 0
    fi
fi


# otherwise, activate project given
_changeproject "$1"
